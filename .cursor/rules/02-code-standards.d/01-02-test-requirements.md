# テスト作成の必須化

**優先度レベル**: `01-XX` - **必須（MUST）** - 絶対に守るべきルール

## 🚨 テスト作成の必須化（最重要ルール）

```
╔══════════════════════════════════════════════════════════════╗
║  🚨 CRITICAL RULE - MUST FOLLOW 🚨                          ║
║                                                              ║
║  新規機能・バグ修正の実装時は、必ずテストを同時に作成する    ║
║  テストなしでのPRマージは禁止                                 ║
║  「後でテストを書く」は許可しない                             ║
╚══════════════════════════════════════════════════════════════╝
```

### 絶対ルール: テストなしでの実装は禁止

**原則として、このルールは全ての実装に適用されます。**

#### ✅ 正しいワークフロー（TDD推奨）

1. **テスト作成**: 実装前に失敗するテストを書く
2. **実装**: テストをパスする最小限の実装
3. **リファクタリング**: コード品質を向上
4. **コミット**: 実装とテストを同時にコミット

#### ⚠️ 許容されるワークフロー（同時実装）

1. **実装とテストを並行**: 機能実装しながらテストも書く
2. **同一PRに含める**: 実装とテストを同じPRでレビュー
3. **コミット**: 実装commitとテストcommitを連続で行う

#### ❌ 禁止されるワークフロー

1. **実装のみでPR作成**: テストなしでPRを出す
2. **「後でテストを書く」**: テストを別PRで対応
3. **テストなしでマージ**: レビュアーがテストなしを許可

### テスト作成の対象

#### Backend

| レイヤー            | 必須テスト  | 理由                         |
| ------------------- | ----------- | ---------------------------- |
| Domain Entity       | Unit        | ビジネスルールの検証         |
| Domain Value Object | Unit        | バリデーションロジックの検証 |
| Domain Service      | Unit        | ドメインロジックの検証       |
| Application UseCase | Unit        | ユースケースのロジック検証   |
| Controller          | E2E         | APIエンドポイントの動作確認  |
| Repository実装      | Integration | データアクセスの検証         |

#### Frontend

| 対象           | 必須テスト | 理由                              |
| -------------- | ---------- | --------------------------------- |
| Component      | Unit       | UIロジックの検証                  |
| Store          | Unit       | 状態管理ロジックの検証            |
| API Client     | Unit       | APIリクエストの検証（モック使用） |
| Utils          | Unit       | ユーティリティ関数の検証          |
| ユーザーフロー | E2E        | 主要な画面遷移の検証              |

### 例外ケース

以下の場合のみ、テストなしでのマージを許可：

1. **ドキュメント変更のみ**: `.md`ファイルの更新のみ
2. **設定ファイル変更のみ**: `tsconfig.json`等の設定変更のみ
3. **緊急のホットフィックス**: セキュリティ修正等（ただし、直後にテスト追加Issueを作成）

### PR作成時のチェックリスト

PRテンプレート（`.github/pull_request_template.md`）には以下のチェックリストが含まれています：

- [ ] 新規追加/変更したすべてのコードに対応するテストを作成した
- [ ] すべてのテストがパスすることを確認した
- [ ] カバレッジレポートを確認し、追加コードがカバーされていることを確認した
- [ ] E2Eテストが必要な場合は追加した
- [ ] ローカルでの4ステップチェックを完了した
  - [ ] `./scripts/test/lint.sh`
  - [ ] `pnpm build`
  - [ ] `./scripts/test/test.sh all`
  - [ ] `./scripts/test/test-e2e.sh frontend`
- [ ] テストなしでマージする場合、例外ケースに該当し、その理由を記載した

**PR作成時は必ずこのチェックリストを確認し、すべての項目をチェックしてください。**

### カバレッジ目標

#### 現在のカバレッジ（2024年11月時点）

- Backend Unit: 35.89%（目標: 80%）
- Backend E2E: 1.23%（目標: 50%）
- Frontend Unit: 47.92%（目標: 80%）

#### 新規実装コードの目標

- **Unit Test Coverage**: 80%以上
- **E2E Test Coverage**: 主要フローを100%カバー

**重要**: 既存コードのカバレッジは段階的に向上させますが、**新規実装コードは必ず80%以上のカバレッジを確保**してください。
