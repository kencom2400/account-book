# 新しいルールファイルの追加ガイドライン

## 概要

このディレクトリに新しいルールファイルを追加する際の手順と注意事項を説明します。

## ファイル名の命名規則

### 基本形式

```
<優先度番号>-<機能名>.md
```

**例**:

- `01-01-type-safety.md` - 型安全性（必須レベル、1番目）
- `02-01-data-access.md` - データアクセス（優先レベル、1番目）
- `03-01-test-guidelines.md` - テスト実装ガイドライン（一般レベル、1番目）
- `04-01-gemini-learnings.md` - Geminiレビューから学んだ観点（メモレベル、1番目）

### 優先度番号の意味

- **数値が小さいほど優先度が高い**
- `01-XX` が最優先（必須レベル）、数が大きくなるほど優先度が低い
- **優先度レベル**:
  - `01-XX`: 必須（MUST）- 絶対に守るべきルール
  - `02-XX`: 優先（SHOULD）- できる限り守るべきルール
  - `03-XX`: 一般（MAY）- 推奨されるルール
  - `04-XX`: メモ（NOTE）- 参考情報・学習記録
- **読み込み順序（重要）**: `@inc-all-rules`で自動的に数値順にソートされるが、**逆順で読み込まれる**
  - 読み込み順序: `04-XX`（メモ）→ `03-XX`（一般）→ `02-XX`（優先）→ `01-XX`（必須）
  - **理由**: 後から読み込まれたルールが優先されるため、矛盾する内容がある場合に優先度の高いルールが優先される

### 現在の優先度構成

#### 必須レベル（01-XX）

1. `01-01-type-safety.md` - 型安全性（最優先）⭐
2. `01-02-test-requirements.md` - テスト作成の必須化
3. `01-03-push-check.md` - push前の必須チェック

#### 優先レベル（02-XX）

4. `02-01-data-access.md` - データアクセスと配列操作
5. `02-02-architecture.md` - アーキテクチャとモジュール設計

#### 一般レベル（03-XX）

6. `03-01-test-guidelines.md` - テスト実装ガイドライン
7. `03-02-eslint-config.md` - ESLint設定
8. `03-03-react-ui.md` - React/UIコンポーネント
9. `03-04-implementation-checklist.md` - 実装フローチェックリスト
10. `03-05-script-tools.md` - スクリプト・ツール開発のベストプラクティス
11. `03-06-shell-scripts.md` - シェルスクリプトのベストプラクティス

#### メモレベル（04-XX）

12. `04-01-gemini-learnings.md` - Geminiレビューから学んだ観点

## 新しいルールファイルを追加する場合

### 基本原則

**重要**: ファイル名の数値プレフィックスは優先度を示します。新しいルールを追加する際は、**その優先度に応じた適切な番号を必ず付けてください**。

- 優先度が高いルール → 小さい番号（`01-`, `02-`, ...）
- 優先度が低いルール → 大きい番号（`13-`, `14-`, ...）

### 手順

1. **優先度を判断**
   - 新しいルールの重要度を評価
   - 既存のルールと比較して、どの位置に挿入すべきか決定

2. **適切な番号を決定**
   - 例: `01-01-type-safety.md`と同等の優先度（必須レベル） → `01-XX`形式
   - 例: `02-01-data-access.md`と同等の優先度（優先レベル） → `02-XX`形式
   - 例: `03-01-test-guidelines.md`と同等の優先度（一般レベル） → `03-XX`形式
   - 例: `04-01-gemini-learnings.md`より優先度が低い（メモレベル） → `04-XX`以降

3. **ファイルを作成**
   - 決定した番号でファイルを作成
   - 既存ファイルの番号と重複する場合は、既存ファイルを繰り下げる

4. **既存ファイルの番号を調整（必要な場合）**
   - 新しいファイルが既存の番号と重複する場合、既存ファイルを1つずつ繰り下げる
   - 例: `01-02-new-rule.md`を追加する場合（必須レベル、2番目）
     - `01-02-test-requirements.md` → `01-03-test-requirements.md`
     - `01-03-push-check.md` → `01-04-push-check.md`
     - ...（以降すべて繰り下げ）

5. **README.mdを更新**
   - 「ファイル一覧と優先順位」セクションに追加
   - 優先度が高い場合は「最優先事項」セクションにも追加

### 実装例

#### 例1: 優先度の高いルールを追加（`01-01-type-safety.md`と同等・必須レベル）

```bash
# 1. 新しいファイルを作成（01-02番として）
cat > .cursor/rules/02-code-standards.d/01-02-security.md << 'EOF'
# セキュリティ（最優先・必須）

このルールは、型安全性と同等の優先度です。
EOF

# 2. 既存ファイルを繰り下げ
git mv 01-02-test-requirements.md 01-03-test-requirements.md
git mv 01-03-push-check.md 01-04-push-check.md
# ... 以降すべて繰り下げ

# 3. README.mdを更新
# 「ファイル一覧と優先順位」セクションを更新
# 「最優先事項（必須レベル）」セクションに追加
```

#### 例2: 優先度が中程度のルールを追加（`03-02-eslint-config.md`と`03-03-react-ui.md`の間・一般レベル）

```bash
# 1. 新しいファイルを作成（03-03番として）
cat > .cursor/rules/02-code-standards.d/03-03-accessibility.md << 'EOF'
# アクセシビリティ

このルールは、アクセシビリティに関するガイドラインです。
EOF

# 2. 既存ファイルを繰り下げ
git mv 03-03-react-ui.md 03-04-react-ui.md
git mv 03-04-implementation-checklist.md 03-05-implementation-checklist.md
# ... 以降すべて繰り下げ

# 3. README.mdを更新
```

#### 例3: 優先度が低いルールを追加（メモレベルに追加）

```bash
# 1. 新しいファイルを作成（04-02番として）
cat > .cursor/rules/02-code-standards.d/04-02-performance.md << 'EOF'
# パフォーマンス最適化

このルールは、パフォーマンスに関するガイドラインです（メモレベル）。
EOF

# 2. README.mdを更新
# 「ファイル一覧と優先順位」セクションの「メモレベル（04-XX）」に追加
```

**注意**: 例3のようにメモレベルに追加するのは、**そのルールの優先度が実際にメモレベル（参考情報）の場合のみ**です。優先度が高いルールをメモレベルに追加することは避けてください。

## 推奨オペレーション

### 基本的な方針

1. **優先度に応じた適切な位置に追加**
   - 新しいルールの優先度を正しく評価する
   - 優先度に応じた適切な番号を付ける
   - 既存ファイルの番号を変更するのは当然の作業として扱う

2. **既存ファイルの番号変更は適切に行う**
   - 新しいルールが既存の番号と重複する場合、既存ファイルを繰り下げる
   - `git mv`を使用してファイル名を変更し、履歴を保持
   - 他のファイルやドキュメントからの参照も更新

3. **README.mdの更新は必須**
   - 新しいファイルを追加したら、必ず`README.md`の「ファイル一覧と優先順位」に追加
   - 優先度が高い場合は、「最優先事項」セクションにも追加

### 重要な原則

**❌ 避けるべきこと**:

- 優先度が高いルールを末尾に追加すること
- 既存ファイルの番号変更を避けるために、優先度を無視すること
- ファイル名から優先度が分からなくなること

**✅ 正しいアプローチ**:

- 新しいルールの優先度を正しく評価する
- 優先度に応じた適切な番号を付ける
- 既存ファイルの番号変更は、優先度を正しく反映するための当然の作業

## 実装例の詳細

上記の「新しいルールファイルを追加する場合」セクションに、3つの実装例を記載しています：

1. **例1**: 優先度の高いルールを追加（`01-01-type-safety.md`と同等・必須レベル）
2. **例2**: 優先度が中程度のルールを追加（`03-02-eslint-config.md`と`03-03-react-ui.md`の間・一般レベル）
3. **例3**: 優先度が低いルールを追加（メモレベルに追加）

すべての例で、**優先度に応じた適切な番号を付ける**ことを前提としています。

## 注意事項

### ファイル番号の変更時の注意

1. **参照の更新**: 他のファイルやドキュメントから参照されている可能性があるため、すべての参照を更新
2. **コミット**: ファイル名変更は`git mv`を使用して、履歴を保持
3. **PR説明**: 番号変更の理由と影響範囲を明確に説明

### 100ファイルを超える場合

現在の形式（2桁: `01-` ～ `99-`）で99ファイルまで対応可能です。

100ファイルを超える場合は、3桁形式（`001-` ～ `999-`）に拡張することを検討してください。この場合、既存ファイルも3桁形式に統一する必要があります。

## まとめ

- **基本原則**: 新しいルールの優先度に応じた適切な番号を付ける
- **番号変更**: 既存ファイルの番号を変更するのは、優先度を正しく反映するための当然の作業
- **必須**: `README.md`の更新は必須
- **注意**: 番号変更時は、他のファイルやドキュメントからの参照も更新する
- **避けるべきこと**: 優先度が高いルールを末尾に追加すること（優先度の意味を無視すること）
