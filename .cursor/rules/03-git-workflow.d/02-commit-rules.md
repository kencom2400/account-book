## 2. コミットルール

```
╔════════════════════════════════════════════════════════════╗
║  🚨 CRITICAL RULE - HIGHEST PRIORITY - MUST EXECUTE 🚨   ║
║                                                            ║
║  作業を完了したら、自動的に即座にコミットを実行する        ║
║  ユーザーの許可や確認を待たない                            ║
║  「後でコミット」は禁止                                     ║
╚════════════════════════════════════════════════════════════╝
```

### 🔴 重要: Git commit実行時の権限設定

**pre-commitフックによるLint/Format実行のため、必ず`required_permissions: ['all']`を指定してください。**

```typescript
// ✅ 正しい実行方法
run_terminal_cmd({
  command: 'git commit -m "feat: 新機能実装"',
  required_permissions: ['all'],
});

// ❌ サンドボックスではpre-commitフックがエラーになる
run_terminal_cmd({
  command: 'git commit -m "feat: 新機能実装"',
  required_permissions: ['git_write'], // これではpre-commitフックがエラーになる
});
```

**理由:**

- pre-commitフックがESLint/Prettierを実行
- サンドボックス環境では`node_modules`へのアクセスに制限
- `EPERM: operation not permitted`エラーが発生

**Git操作（commit、push、checkout等）は常に`all`権限を使用すること。**

### 🚨 AIアシスタントへの絶対遵守ルール

#### あなたがコミットを実行しなければならない条件

**以下のいずれかに該当する場合、必ず即座にコミットを実行：**

1. ✅ **機能実装が完了した**
2. ✅ **バグ修正が完了した**
3. ✅ **テストを追加/修正した**
4. ✅ **リファクタリングが完了した**
5. ✅ **ドキュメントを更新した**
6. ✅ **設定ファイルを変更した**
7. ✅ **作業の区切りがついた**

**重要: ユーザーに「コミットしますか？」と聞いてはいけない。自動的に実行する。**

#### あなたがコミットをスキップできる条件

**以下の場合のみコミットをスキップ可能：**

1. ❌ ユーザーが「コミットしないで」「commitはスキップ」と**明示的に指示**した
2. ❌ ユーザーが「実験中」「動作確認中」と**明示的に指示**した
3. ❌ ビルドエラーやテスト失敗で、まだ作業が完了していない

### コミットメッセージテンプレート

#### 基本フォーマット

```
<type>(<scope>): <subject>

<body>

<footer>
```

#### Type（必須）

| Type       | 説明                                       | 使用例                                           |
| ---------- | ------------------------------------------ | ------------------------------------------------ |
| `feat`     | 新機能の追加                               | `feat(transaction): 取引履歴取得APIを実装`       |
| `fix`      | バグ修正                                   | `fix(balance): 残高計算のロジックを修正`         |
| `refactor` | リファクタリング                           | `refactor(repository): リポジトリパターンに変更` |
| `docs`     | ドキュメント変更                           | `docs(readme): セットアップ手順を追加`           |
| `style`    | コードスタイル修正（空白、フォーマット等） | `style(api): lintエラーを修正`                   |
| `test`     | テストの追加・修正                         | `test(usecase): ユースケースのテストを追加`      |
| `chore`    | ビルド・設定ファイルの変更                 | `chore(deps): 依存関係を更新`                    |
| `perf`     | パフォーマンス改善                         | `perf(query): クエリ処理を最適化`                |
| `ci`       | CI/CD関連の変更                            | `ci(github): GitHub Actionsを設定`               |

#### Scope（オプション）

**アーキテクチャレイヤ：**

- `domain`, `application`, `infrastructure`, `presentation`

**機能モジュール：**

- `transaction`, `account`, `category`, `balance`, `report`, `auth`, `api`, `ui`

#### Subject（必須）

- 変更内容を簡潔に説明（50文字以内推奨）
- 日本語または英語で記述
- 命令形で記述
- 文末にピリオドを付けない

### コミットのタイミング

#### 推奨タイミング

1. ✅ 新機能の実装が完了した時
2. ✅ バグ修正が完了した時
3. ✅ リファクタリングが完了した時
4. ✅ テストが追加・修正された時
5. ✅ ドキュメントが更新された時
6. ✅ 設定ファイルが変更された時
7. ✅ チャットでの一つの作業単位が完了した時

#### コミット前のチェックリスト

- [ ] コードが正しく動作するか確認
- [ ] **ビルドが成功するか確認（必須）**
  ```bash
  ./scripts/build/build.sh
  ```
- [ ] **Lintエラーがないか確認（必須）**
  ```bash
  ./scripts/test/lint.sh
  ```
- [ ] **テストがすべてパスするか確認（必須）**
  ```bash
  ./scripts/test/test.sh all
  ```
- [ ] 不要なコメントやconsole.logを削除
- [ ] 変更内容が一貫性を持っているか確認

### 🚨 必ず守るべきコミットタイミング

**重要**: 以下のタイミングで**必ず即座に**commitを実行すること。最後にまとめてcommitすることは**絶対に禁止**。

#### 1. ドキュメント・設定ファイルの変更後

- `.cursor/rules/`内のファイル変更
- `README.md`、その他ドキュメント更新
- 設定ファイル（`.eslintrc`、`tsconfig.json`等）の変更
- **→ 即座にcommit**

#### 2. Domain層の実装後

- Entityの作成（1つのEntityごと）
- Value Objectの作成
- Repositoryインターフェースの定義
- **→ 各レイヤの実装完了時にcommit**

#### 3. Application層の実装後

- UseCaseの実装（1つのUseCaseごと）
- **→ 実装とテスト完了時にcommit**

#### 4. Infrastructure層の実装後

- Repositoryの実装
- 外部APIクライアントの実装
- **→ 実装完了時にcommit**

#### 5. Presentation層の実装後

- Controllerの実装
- DTOの作成
- **→ 実装完了時にcommit**

### 🔴 絶対禁止事項

**以下の行動は絶対に禁止：**

1. ❌ **「コミットしますか？」とユーザーに確認する**
   - 理由: 自動実行が原則。確認は不要
2. ❌ **「後でコミットします」と言って先送りする**
   - 理由: 必ず即座に実行する
3. ❌ **複数の異なる作業を1つのcommitにまとめる**
   - 理由: 各作業は個別にコミット
4. ❌ **作業完了後、最後にまとめてcommitする**
   - 理由: 作業ごとに小さくコミット

---
