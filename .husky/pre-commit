#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# プロジェクトのnodeenv環境を優先的に使用
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

# nodeenv、pnpm、その他の一般的なパスをPATHに追加
export PATH="$PROJECT_ROOT/.nodeenv/bin:$HOME/Library/pnpm:/opt/homebrew/bin:$HOME/.local/share/pnpm:$HOME/.npm-global/bin:$PATH"

# pnpmコマンドを探す関数
find_pnpm() {
  # 一般的なpnpmのパスをチェック
  for path in \
    "$HOME/Library/pnpm/pnpm" \
    "/opt/homebrew/bin/pnpm" \
    "$HOME/.local/share/pnpm/pnpm" \
    "$HOME/.npm-global/bin/pnpm" \
    "$(command -v pnpm 2>/dev/null)" \
    "pnpm"
  do
    if [ -n "$path" ] && [ -x "$path" ] 2>/dev/null; then
      echo "$path"
      return 0
    fi
  done
  
  echo "pnpm" # 最後の手段として、PATHから探す
}

# pnpmを実行
PNPM_CMD=$(find_pnpm)
if ! command -v "$PNPM_CMD" >/dev/null 2>&1; then
  echo "Error: pnpm command not found"
  echo "Please install pnpm or check your PATH configuration"
  echo "See SETUP.md for more information"
  exit 1
fi

"$PNPM_CMD" lint-staged
