{
  "title": "[FEATURE] FR-009 Phase 7: テスト実装・統合テスト",
  "body": "## 📋 概要\n\nFR-009詳細費目分類機能のPhase 7として、統合テスト・E2Eテストの実装と全体の品質確認を行います。\n\n## 🎯 関連Issue\n\n- 親Issue: #30 (FR-009: 詳細費目分類機能)\n- 前Phase: #296 (Phase 6: Frontend実装)\n\n## 📊 実装内容\n\n### Backend統合テスト\n\n#### 1. サブカテゴリ分類フロー統合テスト\n\n**テストケース**:\n- 店舗マスタ照合による高信頼度分類\n- キーワードマッチングによる中信頼度分類\n- デフォルト分類（その他）\n- 手動分類の上書き\n- トランザクション履歴の記録\n\n**テストファイル**: `subcategory-classification.e2e-spec.ts`\n\n```typescript\ndescribe('Subcategory Classification E2E', () => {\n  it('店舗マスタ照合で高信頼度分類される', async () => {\n    const response = await request(app.getHttpServer())\n      .post('/api/subcategories/classify')\n      .send({\n        description: 'スターバックス コーヒー',\n        amount: 500,\n        mainCategory: 'EXPENSE',\n      })\n      .expect(200);\n\n    expect(response.body.confidence).toBeGreaterThanOrEqual(0.9);\n    expect(response.body.reason).toBe('MERCHANT_MATCH');\n  });\n\n  it('キーワードマッチで中信頼度分類される', async () => {\n    const response = await request(app.getHttpServer())\n      .post('/api/subcategories/classify')\n      .send({\n        description: '電車賃',\n        amount: 300,\n        mainCategory: 'EXPENSE',\n      })\n      .expect(200);\n\n    expect(response.body.confidence).toBeGreaterThanOrEqual(0.7);\n    expect(response.body.confidence).toBeLessThan(0.9);\n    expect(response.body.reason).toBe('KEYWORD_MATCH');\n  });\n\n  it('手動分類で取引が更新される', async () => {\n    // 取引作成\n    const transaction = await createTransaction({\n      description: 'テスト取引',\n      amount: 1000,\n      category: 'EXPENSE',\n    });\n\n    // サブカテゴリ更新\n    const response = await request(app.getHttpServer())\n      .patch(`/api/transactions/${transaction.id}/subcategory`)\n      .send({ subcategoryId: 'food_cafe' })\n      .expect(200);\n\n    expect(response.body.transaction.classificationConfidence).toBe(1.0);\n    expect(response.body.transaction.classificationReason).toBe('MANUAL');\n    expect(response.body.transaction.confirmedAt).toBeDefined();\n  });\n});\n```\n\n#### 2. マイグレーション・シードデータテスト\n\n**テストケース**:\n- マイグレーション実行確認\n- シードデータ投入確認\n- 外部キー制約の確認\n- デフォルトサブカテゴリの存在確認\n\n### Frontend E2Eテスト\n\n#### 1. サブカテゴリ選択フロー\n\n**テストファイル**: `subcategory-classification.spec.ts`\n\n```typescript\nimport { test, expect } from '@playwright/test';\n\ntest.describe('サブカテゴリ分類', () => {\n  test('取引一覧からサブカテゴリを変更できる', async ({ page }) => {\n    await page.goto('/classification');\n\n    // 未分類の取引を選択\n    await page.click('[data-testid=\"transaction-item-0\"]');\n\n    // サブカテゴリ選択モーダルを開く\n    await page.click('[data-testid=\"change-subcategory-button\"]');\n\n    // サブカテゴリを選択\n    await page.click('[data-testid=\"subcategory-food_cafe\"]');\n\n    // 保存\n    await page.click('[data-testid=\"save-button\"]');\n\n    // 成功メッセージ確認\n    await expect(page.locator('[data-testid=\"success-message\"]')).toBeVisible();\n\n    // 信頼度バッジ確認\n    await expect(page.locator('[data-testid=\"confidence-badge\"]')).toContainText('手動分類');\n  });\n\n  test('分類信頼度でフィルタリングできる', async ({ page }) => {\n    await page.goto('/classification');\n\n    // 低信頼度のみ表示\n    await page.click('[data-testid=\"filter-low-confidence\"]');\n\n    // フィルタリング結果確認\n    const transactions = page.locator('[data-testid^=\"transaction-item\"]');\n    const count = await transactions.count();\n    expect(count).toBeGreaterThan(0);\n\n    // すべて低信頼度であることを確認\n    for (let i = 0; i < count; i++) {\n      const badge = transactions.nth(i).locator('[data-testid=\"confidence-badge\"]');\n      await expect(badge).toHaveClass(/low-confidence/);\n    }\n  });\n});\n```\n\n### パフォーマンステスト\n\n#### 1. 分類処理のパフォーマンス\n\n**目標**:\n- 1件の分類: 50ms以内\n- 100件の一括分類: 3秒以内\n- 店舗マスタ検索: 10ms以内\n\n**テストファイル**: `subcategory-performance.spec.ts`\n\n```typescript\ndescribe('Subcategory Classification Performance', () => {\n  it('1件の分類が50ms以内に完了する', async () => {\n    const start = Date.now();\n    await classifySubcategory({\n      description: 'スターバックス',\n      amount: 500,\n      mainCategory: 'EXPENSE',\n    });\n    const duration = Date.now() - start;\n    expect(duration).toBeLessThan(50);\n  });\n\n  it('100件の一括分類が3秒以内に完了する', async () => {\n    const transactions = generateTransactions(100);\n    const start = Date.now();\n    await Promise.all(transactions.map(t => classifySubcategory(t)));\n    const duration = Date.now() - start;\n    expect(duration).toBeLessThan(3000);\n  });\n});\n```\n\n### テストカバレッジ目標\n\n- **ユニットテスト**: 80%以上\n- **統合テスト**: 主要フロー100%\n- **E2Eテスト**: 主要ユーザーシナリオ100%\n\n## ✅ 完了条件\n\n- [ ] Backend統合テスト実装\n- [ ] Frontend E2Eテスト実装\n- [ ] パフォーマンステスト実装\n- [ ] テストカバレッジ目標達成\n- [ ] 全テスト成功\n- [ ] パフォーマンス基準クリア\n- [ ] ドキュメント更新（テスト仕様書）\n\n## 📝 備考\n\n### テストデータ\n\n- 店舗マスタ: 代表的な店舗20件以上\n- サブカテゴリ: 全カテゴリタイプで5階層以上\n- 取引データ: 各分類パターンを網羅\n\n### CI/CD統合\n\n- GitHub Actionsでの自動テスト実行\n- PRマージ前の必須チェック\n- カバレッジレポートの自動生成\n\n### 品質基準\n\n1. **機能性**: すべてのユースケースが正常動作\n2. **パフォーマンス**: 目標値をクリア\n3. **保守性**: テストコードの可読性・保守性が高い\n4. **網羅性**: エッジケースも含めて網羅",
  "labels": ["feature"],
  "assignees": ["kencom2400"],
  "project_id": "PVT_kwDONaiu9s4A0Fjr",
  "status": "📝 To Do",
  "priority": "high"
}

