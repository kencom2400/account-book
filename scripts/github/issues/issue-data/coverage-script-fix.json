{
  "title": "[BUG] ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¿®æ­£ãŒå¿…è¦",
  "labels": ["bug", "testing", "priority: medium"],
  "body": "## ğŸ“‹ æ¦‚è¦\n\n`generate-coverage-report.sh`ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã€å®Ÿéš›ã«ç”Ÿæˆã•ã‚Œã‚‹ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã¨ç•°ãªã‚‹å½¢å¼ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ãŸã‚ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n\n---\n\n## ğŸ› å•é¡Œç‚¹\n\n### 1. ãƒ•ã‚¡ã‚¤ãƒ«åã®ä¸ä¸€è‡´\n\n**æœŸå¾…ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«**: `coverage-summary.json`\n\n**å®Ÿéš›ã«ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«**: `coverage-final.json`\n\nã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä»¥ä¸‹ã®ç®‡æ‰€ã§å•é¡ŒãŒç™ºç”Ÿï¼š\n\n```bash\n# è¡Œ67\nBACKEND_UNIT_DATA=$(extract_coverage_data \"$PROJECT_ROOT/apps/backend/coverage/coverage-summary.json\" \"backend-unit\")\n\n# è¡Œ73\nBACKEND_E2E_DATA=$(extract_coverage_data \"$PROJECT_ROOT/apps/backend/coverage-e2e/coverage-summary.json\" \"backend-e2e\")\n\n# è¡Œ79\nFRONTEND_UNIT_DATA=$(extract_coverage_data \"$PROJECT_ROOT/apps/frontend/coverage/coverage-summary.json\" \"frontend-unit\")\n```\n\n**å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**:\n- `apps/backend/coverage/coverage-final.json`\n- `apps/backend/coverage-e2e/coverage-final.json`\n- `apps/frontend/coverage/coverage-final.json`\n\n### 2. Frontend E2Eãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒæœªå¯¾å¿œ\n\nã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã®ã¿ã«å¯¾å¿œï¼š\n- âœ… Backend ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ\n- âœ… Backend E2Eãƒ†ã‚¹ãƒˆ\n- âœ… Frontend ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ\n- âŒ **Frontend E2Eãƒ†ã‚¹ãƒˆ**ï¼ˆå¯¾å¿œãªã—ï¼‰\n\n### 3. coverage-final.jsonã®å½¢å¼\n\n`coverage-final.json`ã¯ã€`coverage-summary.json`ã¨ã¯ç•°ãªã‚‹å½¢å¼ã§ã™ï¼š\n\n#### coverage-summary.json (æœŸå¾…ã•ã‚Œã‚‹å½¢å¼)\n```json\n{\n  \"total\": {\n    \"lines\": { \"pct\": 85.5 },\n    \"statements\": { \"pct\": 87.2 },\n    \"functions\": { \"pct\": 90.1 },\n    \"branches\": { \"pct\": 78.3 }\n  },\n  \"...å„ãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã®ã‚µãƒãƒªãƒ¼\": {}\n}\n```\n\n#### coverage-final.json (å®Ÿéš›ã®å½¢å¼)\n```json\n{\n  \"/path/to/file.ts\": {\n    \"path\": \"/path/to/file.ts\",\n    \"statementMap\": { ... },\n    \"fnMap\": { ... },\n    \"branchMap\": { ... },\n    \"s\": { ... },\n    \"f\": { ... },\n    \"b\": { ... }\n  },\n  ...\n}\n```\n\n**å®Ÿéš›ã«ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ä¾‹**:\n\n**Backend ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**:\n```json\n// apps/backend/coverage/coverage-final.json\n{\n  \"/Users/kencom/github/account-book/apps/backend/test/helpers/credit-card.factory.ts\": {\n    \"statementMap\": {...},\n    \"s\": {\"0\":0,\"1\":0,...}\n  },\n  ...\n}\n```\n\n**Backend E2Eãƒ†ã‚¹ãƒˆ**:\n```json\n// apps/backend/coverage-e2e/coverage-final.json\n{\n  \"/Users/kencom/github/account-book/apps/backend/test/helpers/credit-card.factory.ts\": {\n    \"statementMap\": {...},\n    \"s\": {\"0\":0,\"1\":0,...}\n  },\n  ...\n}\n```\n\n---\n\n## ğŸ¯ ä¿®æ­£å†…å®¹\n\n### 1. coverage-summary.jsonã®ç”Ÿæˆ\n\nJestã¨Playwrightã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`coverage-final.json`ã®ã¿ã‚’ç”Ÿæˆã—ã¾ã™ã€‚`coverage-summary.json`ã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ã€Istanbulï¼ˆJestã®å†…éƒ¨ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ„ãƒ¼ãƒ«ï¼‰ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\n#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: nycï¼ˆIstanbul CLIï¼‰ã‚’ä½¿ç”¨\n\n```bash\n# coverage-final.json ã‹ã‚‰ coverage-summary.json ã‚’ç”Ÿæˆ\nnpx nyc report --reporter=json-summary --report-dir=coverage --temp-dir=coverage\n```\n\n#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ coverage-final.json ã‚’ç›´æ¥ãƒ‘ãƒ¼ã‚¹\n\n`extract_coverage_data()` é–¢æ•°ã‚’ä¿®æ­£ã—ã¦ã€`coverage-final.json`ã‚’ç›´æ¥ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ï¼š\n\n```bash\nextract_coverage_data() {\n  local coverage_file=$1\n  local module_name=$2\n  \n  if [ ! -f \"$coverage_file\" ]; then\n    echo \"0|0|0|0\"\n    return\n  fi\n  \n  # coverage-final.jsonã‹ã‚‰å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’é›†è¨ˆ\n  local total_statements=0\n  local covered_statements=0\n  local total_functions=0\n  local covered_functions=0\n  local total_branches=0\n  local covered_branches=0\n  \n  # jqã§å„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’é›†è¨ˆ\n  local result=$(jq -r '\n    [.[] | \n      {\n        statements: (.s | length),\n        covered_statements: ([.s[]] | map(select(. > 0)) | length),\n        functions: (.f | length),\n        covered_functions: ([.f[]] | map(select(. > 0)) | length),\n        branches: ([.b[]] | map(length) | add // 0),\n        covered_branches: ([.b[] | .[] | select(. > 0)] | length)\n      }\n    ] | \n    {\n      total_statements: ([.[].statements] | add),\n      covered_statements: ([.[].covered_statements] | add),\n      total_functions: ([.[].functions] | add),\n      covered_functions: ([.[].covered_functions] | add),\n      total_branches: ([.[].branches] | add),\n      covered_branches: ([.[].covered_branches] | add)\n    } |\n    \"\\(.covered_statements / .total_statements * 100)|\\(.covered_statements / .total_statements * 100)|\\(.covered_functions / .total_functions * 100)|\\(.covered_branches / .total_branches * 100)\"\n  ' \"$coverage_file\" 2>/dev/null || echo \"0|0|0|0\")\n  \n  echo \"$result\"\n}\n```\n\n### 2. Frontend E2Eãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®è¿½åŠ \n\nPlaywrightã§ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€è¨­å®šãŒå¿…è¦ã§ã™ã€‚\n\n#### playwright.config.ts ã®æ›´æ–°\n\n```typescript\nimport { defineConfig } from '@playwright/test';\n\nexport default defineConfig({\n  // ...\n  use: {\n    // ...\n    // ã‚«ãƒãƒ¬ãƒƒã‚¸åé›†ã‚’æœ‰åŠ¹åŒ–\n    trace: 'on-first-retry',\n  },\n  // ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆè¨­å®š\n  reporter: [\n    ['html'],\n    ['json', { outputFile: 'test-results/coverage.json' }],\n  ],\n});\n```\n\n#### ã¾ãŸã¯ã€V8 coverage ã‚’ä½¿ç”¨\n\n```bash\n# package.json\n{\n  \"scripts\": {\n    \"test:e2e:cov\": \"playwright test --reporter=html,json --coverage\"\n  }\n}\n```\n\n#### ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«è¿½åŠ \n\n```bash\n# Frontend E2Eãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å–å¾—\necho \"ğŸ“Š Frontend E2Eãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’åé›†ä¸­...\"\ncd \"$PROJECT_ROOT/apps/frontend\"\npnpm test:e2e --coverage > /dev/null 2>&1 || echo \"âš  Frontend e2e test coverage failed\"\nFRONTEND_E2E_DATA=$(extract_coverage_data \"$PROJECT_ROOT/apps/frontend/coverage-e2e/coverage-final.json\" \"frontend-e2e\")\n```\n\n---\n\n## âœ… æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ\n\nä¿®æ­£å¾Œã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å‹•ä½œã™ã‚‹ã¹ãï¼š\n\n1. **ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®ä¸€è‡´**: `coverage-final.json` ã¾ãŸã¯ `coverage-summary.json` ã‚’æ­£ã—ãèª­ã¿è¾¼ã‚€\n2. **å…¨ã‚«ãƒãƒ¬ãƒƒã‚¸ã®åé›†**:\n   - Backend ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ\n   - Backend E2Eãƒ†ã‚¹ãƒˆ\n   - Frontend ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ\n   - **Frontend E2Eãƒ†ã‚¹ãƒˆ**ï¼ˆæ–°è¦è¿½åŠ ï¼‰\n3. **æ­£ç¢ºãªãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹\n\n---\n\n## ğŸ“Š å½±éŸ¿ç¯„å›²\n\n- **å½±éŸ¿åº¦**: Medium\n- **ç·Šæ€¥åº¦**: Medium\n- **å½±éŸ¿ã‚’å—ã‘ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:\n  - `scripts/test/generate-coverage-report.sh`\n  - `docs/testing/coverage-report.md`\n  - `docs/testing/module-coverage/*.md`\n\n---\n\n## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«\n\n- ã‚¹ã‚¯ãƒªãƒ—ãƒˆ: `scripts/test/generate-coverage-report.sh`\n- Backend ã‚«ãƒãƒ¬ãƒƒã‚¸: `apps/backend/coverage/coverage-final.json`\n- Backend E2E ã‚«ãƒãƒ¬ãƒƒã‚¸: `apps/backend/coverage-e2e/coverage-final.json`\n- Frontend ã‚«ãƒãƒ¬ãƒƒã‚¸: `apps/frontend/coverage/coverage-final.json`\n- Playwrightè¨­å®š: `apps/frontend/playwright.config.ts`\n\n---\n\n## ğŸ“ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ\n\n- [ ] `extract_coverage_data()` é–¢æ•°ã‚’ä¿®æ­£ã—ã¦ `coverage-final.json` ã‚’ç›´æ¥ãƒ‘ãƒ¼ã‚¹\n- [ ] ã¾ãŸã¯ã€`nyc` ã‚’ä½¿ç”¨ã—ã¦ `coverage-summary.json` ã‚’ç”Ÿæˆ\n- [ ] Frontend E2Eãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®åé›†ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ \n- [ ] Playwrightè¨­å®šã§ã‚«ãƒãƒ¬ãƒƒã‚¸åé›†ã‚’æœ‰åŠ¹åŒ–ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰\n- [ ] ãƒ¬ãƒãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã« Frontend E2E ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¿½åŠ \n- [ ] ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¨å‹•ä½œç¢ºèª\n- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼ˆä½¿ç”¨æ–¹æ³•ã€æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼‰\n\n---\n\n## ğŸ“– å‚è€ƒè³‡æ–™\n\n- [Jest Coverage Configuration](https://jestjs.io/docs/configuration#coveragereporters-arraystring--string-options)\n- [Istanbul/nyc Documentation](https://istanbul.js.org/)\n- [Playwright Test Coverage](https://playwright.dev/docs/test-reporters#coverage)\n"
}
