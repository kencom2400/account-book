# apps/frontend/Dockerfile.dev
FROM node:20-alpine

# pnpmのインストール
RUN npm install -g pnpm@8.15.0

# 作業ディレクトリ
WORKDIR /app

# 依存関係のコピーとインストール
COPY package.json pnpm-workspace.yaml pnpm-lock.yaml ./
COPY apps/frontend/package.json ./apps/frontend/
COPY libs/types/package.json ./libs/types/
COPY libs/utils/package.json ./libs/utils/

# postinstallスクリプトをスキップ（Alpine LinuxではPlaywrightの--with-depsが動作しないため）
# 開発環境ではPlaywrightのブラウザインストールは不要（E2Eテストは別コンテナで実行）
RUN pnpm install --frozen-lockfile --ignore-scripts

# ソースコードのコピー
COPY . .

# libs のビルド
RUN pnpm run build --filter=@account-book/types
RUN pnpm run build --filter=@account-book/utils

# ポート公開
EXPOSE 3000

# 開発サーバー起動
WORKDIR /app/apps/frontend
CMD ["pnpm", "dev"]

