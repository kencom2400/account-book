# 機能要件書：設定機能

**文書バージョン**: 1.0  
**作成日**: 2025-11-15  
**最終更新日**: 2025-11-15

## 目次
- [FR-028: 金融機関接続設定の画面管理](#fr-028-金融機関接続設定の画面管理)
- [FR-029: 認証情報の登録・更新・削除](#fr-029-認証情報の登録更新削除)
- [FR-030: データ同期間隔の設定](#fr-030-データ同期間隔の設定)
- [FR-031: カテゴリ・費目のカスタマイズ](#fr-031-カテゴリ費目のカスタマイズ)

---

## FR-028: 金融機関接続設定の画面管理

### 基本情報
| 項目 | 内容 |
|------|------|
| 機能ID | FR-028 |
| 機能名 | 金融機関接続設定の画面管理 |
| 優先度 | 高 |
| 対応Phase | Phase 3 |

### 概要
ユーザーが金融機関との連携を画面上で設定・管理できる機能。直感的なUIで金融機関の追加、編集、削除、接続状態の確認を行う。

### 詳細仕様

#### 設定画面構成

##### 1. 金融機関一覧画面
```
┌─────────────────────────────────────────┐
│ 金融機関設定                              │
├─────────────────────────────────────────┤
│ [+ 金融機関を追加]                         │
│                                          │
│ ┌──────────────────────────────────┐    │
│ │ 🏦 三菱UFJ銀行                     │    │
│ │ 普通預金 ●●●●1234                  │    │
│ │ 接続状態: ✓ 正常                   │    │
│ │ 最終同期: 2025-11-15 10:30        │    │
│ │ [編集] [削除] [今すぐ同期]         │    │
│ └──────────────────────────────────┘    │
│                                          │
│ ┌──────────────────────────────────┐    │
│ │ 💳 楽天カード                      │    │
│ │ カード番号: ●●●● ●●●● 5678        │    │
│ │ 接続状態: ⚠ 再認証が必要          │    │
│ │ 最終同期: 2025-11-14 23:00        │    │
│ │ [編集] [削除] [再接続]            │    │
│ └──────────────────────────────────┘    │
└─────────────────────────────────────────┘
```

##### 2. 金融機関追加画面
```
┌─────────────────────────────────────────┐
│ 金融機関を追加                            │
├─────────────────────────────────────────┤
│ ステップ1: 種類を選択                      │
│ [ 銀行 ] [ クレジットカード ] [ 証券 ]     │
│                                          │
│ ステップ2: 金融機関を選択                   │
│ 🔍 検索: [____________]                  │
│                                          │
│ よく使われる:                             │
│ [🏦 三菱UFJ銀行]  [🏦 三井住友銀行]       │
│ [💳 楽天カード]    [💳 JCBカード]         │
│                                          │
│ すべての金融機関:                          │
│ - 三菱UFJ銀行                            │
│ - 三井住友銀行                           │
│ - みずほ銀行                             │
│ ...                                      │
│                                          │
│ [キャンセル] [次へ]                       │
└─────────────────────────────────────────┘
```

##### 3. 認証情報入力画面
金融機関ごとに動的に変化する入力フォーム

```
┌─────────────────────────────────────────┐
│ 三菱UFJ銀行との連携                        │
├─────────────────────────────────────────┤
│ 接続に必要な情報を入力してください           │
│                                          │
│ 銀行コード: [0005]                       │
│ 支店コード: [___]                        │
│ 口座番号:   [_______]                    │
│ APIキー:    [____________________]       │
│                                          │
│ ℹ APIキーの取得方法                       │
│                                          │
│ [キャンセル] [接続テスト]                  │
└─────────────────────────────────────────┘
```

#### 入力
- 金融機関選択
- 金融機関種別（銀行、クレジットカード、証券）
- 検索キーワード（金融機関名での絞り込み）
- 認証情報（金融機関ごとに異なる）

#### 出力
- 登録済み金融機関一覧
- 各金融機関の接続状態
- 最終同期日時
- 設定変更の成功/失敗通知

#### 処理フロー
```
[金融機関一覧表示]
1. 登録済み金融機関情報をロード
2. 各金融機関の接続状態を取得
3. 一覧形式で表示
4. 接続状態に応じてアイコン/色を変更

[金融機関追加]
1. 「金融機関を追加」ボタンクリック
2. 金融機関種別選択画面を表示
3. 種別選択
4. 対応金融機関一覧を表示
5. 金融機関を選択
6. 認証情報入力画面を表示
7. 認証情報を入力
8. 「接続テスト」ボタンクリック
9. バックエンドで接続テスト実施
10. [成功時]
    a. 認証情報を保存
    b. 初回データ取得開始
    c. 一覧画面に戻る
    d. 成功通知を表示
11. [失敗時]
    a. エラーメッセージを表示
    b. 入力フォームに戻る

[金融機関編集]
1. 一覧から編集対象を選択
2. 現在の設定情報を表示
3. 認証情報等を編集
4. 「保存」ボタンクリック
5. 接続テスト実施
6. 更新を保存

[金融機関削除]
1. 一覧から削除対象を選択
2. 確認ダイアログを表示
3. ユーザーが確認
4. 金融機関情報と取引履歴の扱いを選択
   - 金融機関情報のみ削除（取引履歴は保持）
   - すべて削除
5. 削除実行
6. 一覧を更新
```

#### バリデーション
- 必須項目の入力チェック
- 金融機関固有の形式チェック
  - 銀行コード: 4桁数字
  - 支店コード: 3桁数字
  - 口座番号: 7桁数字
  - カード番号: 16桁数字（4桁ずつ区切り可）
- APIキー/トークンの形式チェック
- 重複登録チェック（同じ口座/カードの二重登録防止）

#### 接続状態表示
| 状態 | アイコン | 色 | 説明 |
|------|---------|---|------|
| 正常 | ✓ | 緑 | 接続成功、データ取得可能 |
| 警告 | ⚠ | 黄 | 接続可能だが一部問題あり |
| エラー | ✗ | 赤 | 接続失敗、再認証が必要 |
| 停止 | ○ | 灰 | ユーザーが同期を停止中 |
| 同期中 | ↻ | 青 | データ取得中 |

#### エラー処理
| エラーコード | エラー内容 | 対処方法 |
|-------------|-----------|---------|
| SE001 | 金融機関が選択されていない | 金融機関を選択してください |
| SE002 | 認証情報が不正 | 入力内容を確認してください |
| SE003 | 接続テスト失敗 | 認証情報を確認するか、後で再試行 |
| SE004 | 重複登録 | この口座は既に登録されています |
| SE005 | 削除失敗 | システムエラー、管理者に連絡 |
| SE006 | 更新失敗 | 一時的なエラー、再試行してください |

#### セキュリティ要件
- 認証情報は暗号化して保存
- 画面上では口座番号/カード番号をマスキング表示（●●●●1234）
- パスワード入力欄はマスク表示
- セッションタイムアウト時は再認証要求
- APIキーは絶対にログに出力しない

#### 関連機能
- FR-001: 銀行口座との連携
- FR-002: クレジットカードとの連携
- FR-003: 証券会社との連携
- FR-004: バックグラウンド接続確認
- FR-029: 認証情報の登録・更新・削除

#### テストケース

##### TC-028-001: 金融機関一覧の表示
**前提条件**: 2つの金融機関が登録済み
**手順**:
1. 設定画面を開く
**期待結果**: 登録済み2つの金融機関が一覧表示される

##### TC-028-002: 銀行の追加（正常系）
**前提条件**: 未登録の銀行口座情報を持っている
**手順**:
1. 「金融機関を追加」をクリック
2. 「銀行」を選択
3. 三菱UFJ銀行を選択
4. 認証情報を入力
5. 「接続テスト」をクリック
**期待結果**: 
- 接続成功メッセージが表示される
- 一覧に追加された銀行が表示される

##### TC-028-003: 銀行の追加（異常系：認証エラー）
**前提条件**: なし
**手順**:
1. 「金融機関を追加」をクリック
2. 銀行を選択
3. 誤った認証情報を入力
4. 「接続テスト」をクリック
**期待結果**: 
- エラーメッセージが表示される
- 一覧に追加されない
- 入力フォームに戻る

##### TC-028-004: クレジットカードの追加
**前提条件**: 未登録のクレジットカード情報を持っている
**手順**:
1. 「金融機関を追加」をクリック
2. 「クレジットカード」を選択
3. カード会社を選択
4. 認証情報を入力
5. 「接続テスト」をクリック
**期待結果**: 
- 接続成功
- 一覧にクレジットカードが追加される

##### TC-028-005: 金融機関の編集
**前提条件**: 1つの金融機関が登録済み
**手順**:
1. 一覧から「編集」をクリック
2. APIキーを変更
3. 「保存」をクリック
**期待結果**: 
- 接続テストが実行される
- 変更が保存される
- 成功メッセージが表示される

##### TC-028-006: 金融機関の削除（取引履歴保持）
**前提条件**: 1つの金融機関が登録済み、取引履歴あり
**手順**:
1. 一覧から「削除」をクリック
2. 確認ダイアログで「取引履歴は保持」を選択
3. 「削除」をクリック
**期待結果**: 
- 金融機関が一覧から削除される
- 過去の取引履歴は保持される

##### TC-028-007: 金融機関の削除（すべて削除）
**前提条件**: 1つの金融機関が登録済み、取引履歴あり
**手順**:
1. 一覧から「削除」をクリック
2. 確認ダイアログで「すべて削除」を選択
3. 「削除」をクリック
**期待結果**: 
- 金融機関が一覧から削除される
- 取引履歴も削除される

##### TC-028-008: 重複登録の防止
**前提条件**: 三菱UFJ銀行の口座が登録済み
**手順**:
1. 同じ口座を再度登録しようとする
**期待結果**: 
- エラーメッセージ「この口座は既に登録されています」が表示される
- 登録できない

##### TC-028-009: 検索機能
**前提条件**: なし
**手順**:
1. 金融機関追加画面を開く
2. 検索欄に「楽天」と入力
**期待結果**: 
- 楽天銀行、楽天カード等が絞り込まれて表示される

##### TC-028-010: 接続状態の色分け表示
**前提条件**: 接続状態が異なる複数の金融機関が登録済み
**手順**:
1. 一覧画面を表示
**期待結果**: 
- 正常: 緑色のチェックマーク
- エラー: 赤色のバツマーク
- 警告: 黄色の警告マーク

#### UI/UX要件
- レスポンシブデザイン（PC/タブレット/スマホ対応）
- 金融機関のロゴアイコンを表示
- ローディング中は適切なスピナー表示
- アクション（追加、編集、削除）後は成功/失敗のトースト通知
- 削除時は必ず確認ダイアログを表示
- APIキー取得方法へのヘルプリンク
- エラー時は具体的な対処方法を表示

#### パフォーマンス要件
- 一覧画面の表示: 1秒以内
- 接続テストの実行: 5秒以内
- 金融機関数が100を超えても快適に動作

---

## FR-029: 認証情報の登録・更新・削除

### 基本情報
| 項目 | 内容 |
|------|------|
| 機能ID | FR-029 |
| 機能名 | 認証情報の登録・更新・削除 |
| 優先度 | 高 |
| 対応Phase | Phase 3 |

### 概要
金融機関との連携に必要な認証情報を安全に管理する機能。暗号化して保存し、必要に応じて更新・削除を行う。

### 詳細仕様

#### 認証情報の種類

##### 1. 銀行の認証情報
```typescript
interface BankCredentials {
  institutionId: string;
  institutionName: string;
  bankCode: string;        // 銀行コード（4桁）
  branchCode: string;      // 支店コード（3桁）
  accountNumber: string;   // 口座番号（7桁）
  accountType: 'saving' | 'checking'; // 普通/当座
  apiKey?: string;         // APIキー
  apiSecret?: string;      // APIシークレット
  accessToken?: string;    // アクセストークン
  refreshToken?: string;   // リフレッシュトークン
  tokenExpiresAt?: Date;   // トークン有効期限
}
```

##### 2. クレジットカードの認証情報
```typescript
interface CreditCardCredentials {
  institutionId: string;
  institutionName: string;
  cardNumber: string;      // カード番号（16桁、暗号化）
  cardHolderName: string;  // カード名義
  expiryDate: string;      // 有効期限（MM/YY）
  apiKey?: string;
  apiSecret?: string;
  accessToken?: string;
  refreshToken?: string;
  tokenExpiresAt?: Date;
  billingDay: number;      // 締め日
  paymentDay: number;      // 支払日
}
```

##### 3. 証券会社の認証情報
```typescript
interface SecuritiesCredentials {
  institutionId: string;
  institutionName: string;
  accountNumber: string;   // 口座番号
  branchCode?: string;     // 店番
  apiKey: string;
  apiSecret: string;
  accessToken?: string;
  refreshToken?: string;
  tokenExpiresAt?: Date;
}
```

#### 認証情報の暗号化

##### 暗号化対象フィールド
- 口座番号
- カード番号
- APIキー
- APIシークレット
- アクセストークン
- リフレッシュトークン

##### 暗号化方式
- アルゴリズム: AES-256-GCM
- キー管理: 環境変数またはキーストアから取得
- 初期化ベクトル（IV）: ランダム生成
- 認証タグ: 暗号文の改ざん検出

##### 暗号化データ構造
```typescript
interface EncryptedData {
  encrypted: string;       // 暗号化されたデータ（Base64）
  iv: string;              // 初期化ベクトル（Base64）
  authTag: string;         // 認証タグ（Base64）
  algorithm: 'aes-256-gcm';
  version: string;         // 暗号化バージョン
}
```

#### 入力
**登録時**:
- 金融機関ID
- 認証情報（金融機関により異なる）
- 認証方式（APIキー、OAuth等）

**更新時**:
- 金融機関ID
- 更新する認証情報

**削除時**:
- 金融機関ID

#### 出力
- 処理成功/失敗ステータス
- エラーメッセージ（失敗時）
- 暗号化された認証情報ID（登録時）

#### 処理フロー

##### 登録フロー
```
1. ユーザーが認証情報を入力
2. [フロントエンド] 入力値のバリデーション
3. [バックエンド] 受信
4. [暗号化] 機密情報をAES-256-GCMで暗号化
5. [保存] 暗号化データをJSON/DBに保存
6. [ID生成] 一意のcredentialIDを生成
7. [関連付け] institutionIdとcredentialIdを関連付け
8. [レスポンス] 成功ステータスを返却
9. [接続テスト] 認証情報の有効性を確認
10. [結果通知] ユーザーに通知
```

##### 更新フロー
```
1. ユーザーが認証情報編集画面を開く
2. [既存情報取得] 現在の認証情報を取得（マスキング表示）
3. ユーザーが認証情報を編集
4. [バリデーション] 入力値チェック
5. [暗号化] 新しい認証情報を暗号化
6. [上書き保存] 既存データを上書き
7. [接続テスト] 新しい認証情報で接続確認
8. [成功時] 変更を確定
9. [失敗時] ロールバック、エラー表示
10. [通知] ユーザーに結果を通知
```

##### 削除フロー
```
1. ユーザーが削除を実行
2. [確認ダイアログ] 削除確認
3. [オプション選択] 
   - 認証情報のみ削除（同期停止）
   - 金融機関との連携をすべて削除
4. ユーザーが確認
5. [削除実行] 認証情報を削除
6. [関連処理]
   - 定期同期ジョブの停止
   - 接続状態の更新
7. [通知] 削除完了を通知
```

##### トークンリフレッシュフロー（OAuth認証の場合）
```
1. [バックグラウンド] トークン有効期限をチェック
2. [期限切れ検出] アクセストークンの有効期限が近い
3. [リフレッシュAPI呼び出し] リフレッシュトークンを使用
4. [新トークン取得] 新しいアクセストークンを取得
5. [暗号化] 新トークンを暗号化
6. [更新] 保存されている認証情報を更新
7. [ログ記録] トークン更新履歴を記録
8. [失敗時]
   a. リトライ（最大3回）
   b. すべて失敗した場合、再認証要求通知
```

#### バリデーション
- 必須項目チェック
- フォーマットチェック
  - 銀行コード: 4桁数字
  - 支店コード: 3桁数字
  - 口座番号: 7桁数字
  - カード番号: 16桁数字（Luhnアルゴリズムチェック）
  - 有効期限: MM/YY形式、未来の日付
- APIキー/トークンの長さチェック
- 文字種チェック（英数字、記号等）

#### エラー処理
| エラーコード | エラー内容 | 対処方法 |
|-------------|-----------|---------|
| CR001 | 認証情報が不正 | 正しい情報を入力してください |
| CR002 | 暗号化失敗 | システムエラー、管理者に連絡 |
| CR003 | 保存失敗 | 一時的なエラー、再試行してください |
| CR004 | 復号化失敗 | データが破損しています、再登録してください |
| CR005 | 認証情報が見つからない | 該当する認証情報が存在しません |
| CR006 | 更新権限なし | この操作は許可されていません |
| CR007 | トークンリフレッシュ失敗 | 再認証が必要です |
| CR008 | 重複登録 | この認証情報は既に登録されています |

#### セキュリティ要件

##### 1. 暗号化の必須化
- すべての機密情報は暗号化して保存
- 平文での保存は禁止
- メモリ上でも可能な限り暗号化を維持

##### 2. アクセス制御
- 認証情報へのアクセスはユーザー認証必須
- APIエンドポイントは認証トークンで保護
- 読み取り/書き込み権限の分離

##### 3. 監査ログ
```typescript
interface CredentialAuditLog {
  timestamp: Date;
  userId: string;
  action: 'create' | 'read' | 'update' | 'delete';
  institutionId: string;
  ipAddress: string;
  userAgent: string;
  result: 'success' | 'failure';
  errorCode?: string;
}
```

##### 4. セッション管理
- 設定画面は15分の無操作でタイムアウト
- タイムアウト後は再認証要求
- 認証情報の表示時は追加の本人確認

##### 5. セキュアな通信
- すべてのAPIリクエストはHTTPS必須
- TLS 1.2以上を使用
- 証明書の検証必須

##### 6. キーの管理
- 暗号化キーは環境変数で管理
- ソースコードには埋め込まない
- 定期的なキーローテーション（年1回以上）
- キー漏洩時の緊急対応手順

#### データ保存形式

##### JSON形式（初期フェーズ）
```json
{
  "institutions": [
    {
      "id": "inst_001",
      "name": "三菱UFJ銀行",
      "type": "bank",
      "credentials": {
        "encrypted": "base64EncryptedData...",
        "iv": "base64IV...",
        "authTag": "base64AuthTag...",
        "algorithm": "aes-256-gcm",
        "version": "1.0"
      },
      "connectionStatus": "connected",
      "lastSyncedAt": "2025-11-15T10:30:00Z",
      "createdAt": "2025-11-01T09:00:00Z",
      "updatedAt": "2025-11-15T10:30:00Z"
    }
  ]
}
```

##### データベース（将来フェーズ）
```sql
CREATE TABLE credentials (
  id VARCHAR(36) PRIMARY KEY,
  institution_id VARCHAR(36) NOT NULL,
  encrypted_data TEXT NOT NULL,
  iv TEXT NOT NULL,
  auth_tag TEXT NOT NULL,
  algorithm VARCHAR(20) NOT NULL,
  version VARCHAR(10) NOT NULL,
  created_at TIMESTAMP NOT NULL,
  updated_at TIMESTAMP NOT NULL,
  FOREIGN KEY (institution_id) REFERENCES institutions(id)
);

CREATE INDEX idx_credentials_institution ON credentials(institution_id);
```

#### 関連機能
- FR-028: 金融機関接続設定の画面管理
- FR-001: 銀行口座との連携
- FR-002: クレジットカードとの連携
- FR-003: 証券会社との連携

#### テストケース

##### TC-029-001: 認証情報の登録（正常系）
**前提条件**: なし
**手順**:
1. 認証情報を入力
2. 登録を実行
**期待結果**: 
- 暗号化されて保存される
- 接続テストが成功する

##### TC-029-002: 認証情報の登録（異常系：不正な形式）
**前提条件**: なし
**手順**:
1. 誤った形式の口座番号を入力
2. 登録を実行
**期待結果**: 
- バリデーションエラーが表示される
- 保存されない

##### TC-029-003: 認証情報の更新
**前提条件**: 認証情報が登録済み
**手順**:
1. 認証情報を編集
2. APIキーを変更
3. 保存を実行
**期待結果**: 
- 新しい認証情報で暗号化される
- 接続テストが成功する
- 更新日時が更新される

##### TC-029-004: 認証情報の削除
**前提条件**: 認証情報が登録済み
**手順**:
1. 削除を実行
2. 確認ダイアログで確認
**期待結果**: 
- 認証情報が削除される
- 関連する金融機関の接続状態が「停止」になる

##### TC-029-005: 暗号化・復号化の正常性
**前提条件**: なし
**手順**:
1. 認証情報を登録
2. 暗号化されたデータを確認
3. 復号化して元のデータと比較
**期待結果**: 
- 元のデータと復号化後のデータが一致する

##### TC-029-006: トークンリフレッシュ（成功）
**前提条件**: OAuth認証の金融機関が登録済み、トークン有効期限が近い
**手順**:
1. バックグラウンドジョブが実行される
**期待結果**: 
- 新しいアクセストークンが取得される
- 認証情報が更新される
- 接続状態が「正常」のまま

##### TC-029-007: トークンリフレッシュ（失敗）
**前提条件**: OAuth認証の金融機関が登録済み、リフレッシュトークンが無効
**手順**:
1. バックグラウンドジョブが実行される
**期待結果**: 
- リトライが3回実行される
- すべて失敗後、接続状態が「エラー」になる
- ユーザーに再認証要求の通知が送られる

##### TC-029-008: セッションタイムアウト後のアクセス
**前提条件**: ログイン後15分経過
**手順**:
1. 認証情報の閲覧を試みる
**期待結果**: 
- 再認証画面が表示される
- 認証後に元の画面に戻る

##### TC-029-009: 重複登録の防止
**前提条件**: 特定の口座が登録済み
**手順**:
1. 同じ口座番号で再度登録を試みる
**期待結果**: 
- エラーメッセージが表示される
- 登録されない

##### TC-029-010: 監査ログの記録
**前提条件**: なし
**手順**:
1. 認証情報を登録
2. 認証情報を更新
3. 認証情報を削除
**期待結果**: 
- すべてのアクションが監査ログに記録される
- タイムスタンプ、ユーザーID、アクション種別が記録される

#### パフォーマンス要件
- 暗号化処理: 100ms以内
- 復号化処理: 100ms以内
- 認証情報の保存: 500ms以内
- トークンリフレッシュ: 3秒以内

---

## FR-030: データ同期間隔の設定

### 基本情報
| 項目 | 内容 |
|------|------|
| 機能ID | FR-030 |
| 機能名 | データ同期間隔の設定 |
| 優先度 | 中 |
| 対応Phase | Phase 4 |

### 概要
各金融機関からデータを取得する頻度を設定する機能。ユーザーのニーズに応じて同期間隔をカスタマイズできる。

### 詳細仕様

#### 同期間隔のオプション

##### プリセット間隔
| 間隔 | 説明 | ユースケース |
|------|------|------------|
| リアルタイム | 5分ごと | 頻繁に取引を確認したい |
| 高頻度 | 1時間ごと | 日中の変動を把握したい |
| 標準（推奨） | 6時間ごと | 一般的な利用 |
| 低頻度 | 1日1回 | データ量を抑えたい |
| 手動のみ | 自動同期なし | 必要な時だけ同期 |

##### カスタム間隔
- 分単位: 5分〜59分
- 時間単位: 1時間〜23時間
- 日単位: 1日〜30日
- 曜日指定: 毎週●曜日
- 日時指定: 毎月●日●時

#### 設定画面UI

```
┌─────────────────────────────────────────┐
│ データ同期設定                            │
├─────────────────────────────────────────┤
│                                          │
│ ■ 全体設定                               │
│ ┌──────────────────────────────────┐    │
│ │ デフォルト同期間隔                 │    │
│ │ ○ リアルタイム（5分ごと）          │    │
│ │ ○ 高頻度（1時間ごと）             │    │
│ │ ● 標準（6時間ごと）【推奨】        │    │
│ │ ○ 低頻度（1日1回）                │    │
│ │ ○ 手動のみ                        │    │
│ │ ○ カスタム [___時間ごと]          │    │
│ └──────────────────────────────────┘    │
│                                          │
│ ■ 金融機関ごとの設定                       │
│ ┌──────────────────────────────────┐    │
│ │ 🏦 三菱UFJ銀行                     │    │
│ │ 同期間隔: [標準 ▼]                │    │
│ │ 最終同期: 2025-11-15 10:30        │    │
│ │ 次回同期: 2025-11-15 16:30        │    │
│ │ [今すぐ同期]                       │    │
│ └──────────────────────────────────┘    │
│                                          │
│ ┌──────────────────────────────────┐    │
│ │ 💳 楽天カード                      │    │
│ │ 同期間隔: [低頻度 ▼]              │    │
│ │ 最終同期: 2025-11-15 00:00        │    │
│ │ 次回同期: 2025-11-16 00:00        │    │
│ │ [今すぐ同期]                       │    │
│ └──────────────────────────────────┘    │
│                                          │
│ ■ 詳細オプション                          │
│ □ Wi-Fi接続時のみ自動同期する             │
│ □ バッテリー節約モード時は同期を控える      │
│ □ エラー時は自動リトライする（最大3回）    │
│ □ 夜間（22:00-6:00）は同期を停止する      │
│                                          │
│ [キャンセル] [保存]                       │
└─────────────────────────────────────────┘
```

#### データ構造

##### 同期設定
```typescript
interface SyncSettings {
  // 全体設定
  defaultInterval: SyncInterval;
  
  // 金融機関ごとの設定
  institutionSettings: InstitutionSyncSettings[];
  
  // 詳細オプション
  wifiOnly: boolean;
  batterySavingMode: boolean;
  autoRetry: boolean;
  maxRetryCount: number;
  nightModeSuspend: boolean;
  nightModeStart: string;  // HH:mm
  nightModeEnd: string;    // HH:mm
}

interface SyncInterval {
  type: 'realtime' | 'frequent' | 'standard' | 'infrequent' | 'manual' | 'custom';
  value?: number;          // カスタムの場合の値
  unit?: 'minutes' | 'hours' | 'days';
  customSchedule?: CronExpression; // 高度なスケジュール
}

interface InstitutionSyncSettings {
  institutionId: string;
  interval: SyncInterval;
  enabled: boolean;
  lastSyncedAt?: Date;
  nextSyncAt?: Date;
  syncStatus: 'idle' | 'syncing' | 'error';
  errorCount: number;
  lastError?: string;
}
```

#### 入力
- デフォルト同期間隔
- 金融機関ごとの同期間隔
- 詳細オプション（Wi-Fiのみ、バッテリー節約等）

#### 出力
- 保存成功/失敗ステータス
- 次回同期予定時刻
- 設定変更通知

#### 処理フロー

##### 同期間隔設定フロー
```
1. ユーザーが設定画面を開く
2. 現在の設定を表示
3. ユーザーが同期間隔を変更
4. [バリデーション] 設定値のチェック
5. [保存] 設定をJSON/DBに保存
6. [スケジュール更新] 次回同期時刻を計算
7. [ジョブ登録] バックグラウンドジョブを更新
8. [通知] 保存完了を通知
```

##### 自動同期実行フロー
```
1. [スケジューラ] 定期的に同期ジョブをチェック
2. [時刻判定] 次回同期時刻に達したかチェック
3. [条件判定]
   a. Wi-Fi接続チェック（wifiOnly=trueの場合）
   b. バッテリー残量チェック（batterySavingMode=trueの場合）
   c. 夜間モードチェック（nightModeSuspend=trueの場合）
4. [条件を満たす場合]
   a. 同期開始
   b. ステータスを「syncing」に更新
   c. 金融機関APIからデータ取得
   d. データを保存
   e. ステータスを「idle」に更新
   f. lastSyncedAtを更新
   g. 次回同期時刻を計算・設定
5. [条件を満たさない場合]
   a. 同期をスキップ
   b. 次回チェック時刻を設定
6. [エラー発生時]
   a. エラーカウントを増加
   b. autoRetry=trueの場合、リトライ
   c. maxRetryCountを超えた場合、ユーザーに通知
```

##### 手動同期フロー
```
1. ユーザーが「今すぐ同期」ボタンをクリック
2. [確認] 既に同期中でないかチェック
3. [同期開始] バックグラウンドで同期実行
4. [UI更新] ローディングスピナー表示
5. [同期完了] 
   a. 最終同期時刻を更新
   b. 取得したデータ件数を表示
   c. 成功通知
6. [エラー時]
   a. エラーメッセージを表示
   b. 対処方法を提示
```

#### バリデーション
- 同期間隔の範囲チェック
  - 最小: 5分
  - 最大: 30日
- カスタム間隔の数値チェック（正の整数）
- 夜間モード時刻の形式チェック（HH:mm）
- 夜間モード開始時刻 < 終了時刻

#### エラー処理
| エラーコード | エラー内容 | 対処方法 |
|-------------|-----------|---------|
| SY001 | 不正な同期間隔 | 5分〜30日の範囲で設定してください |
| SY002 | 同期中にエラー発生 | しばらく待ってから再試行してください |
| SY003 | 接続エラー | ネットワーク接続を確認してください |
| SY004 | 認証エラー | 認証情報を更新してください |
| SY005 | API制限エラー | 同期間隔を長くしてください |
| SY006 | 設定保存失敗 | システムエラー、再試行してください |

#### 同期ジョブスケジューラ

##### 実装方式
- Node.jsの`node-cron`または`bull`を使用
- ジョブキューで管理
- 失敗時のリトライ機能

##### スケジューラ設定例
```typescript
// リアルタイム（5分ごと）
cron.schedule('*/5 * * * *', syncJob);

// 高頻度（1時間ごと）
cron.schedule('0 * * * *', syncJob);

// 標準（6時間ごと）
cron.schedule('0 */6 * * *', syncJob);

// 低頻度（毎日0時）
cron.schedule('0 0 * * *', syncJob);
```

#### 同期履歴の記録

##### 同期ログ
```typescript
interface SyncLog {
  id: string;
  institutionId: string;
  startedAt: Date;
  completedAt?: Date;
  status: 'success' | 'partial' | 'failure';
  recordsFetched: number;
  errorMessage?: string;
  duration: number; // ミリ秒
}
```

##### 同期履歴画面
```
┌─────────────────────────────────────────┐
│ 同期履歴                                  │
├─────────────────────────────────────────┤
│ 📅 2025-11-15                            │
│                                          │
│ 10:30 三菱UFJ銀行 ✓ 成功 (5件取得)        │
│ 10:31 楽天カード   ✓ 成功 (12件取得)      │
│ 10:32 SBI証券     ✗ 失敗 (接続エラー)     │
│                                          │
│ 📅 2025-11-14                            │
│                                          │
│ 00:00 三菱UFJ銀行 ✓ 成功 (3件取得)        │
│ 00:01 楽天カード   ✓ 成功 (8件取得)       │
│ 00:02 SBI証券     ✓ 成功 (2件取得)       │
└─────────────────────────────────────────┘
```

#### API制限への対応

##### レート制限の管理
```typescript
interface RateLimit {
  institutionId: string;
  requestsPerHour: number;
  requestsPerDay: number;
  currentHourCount: number;
  currentDayCount: number;
  resetHourAt: Date;
  resetDayAt: Date;
}
```

##### 制限超過時の対応
1. 同期間隔を自動的に調整
2. ユーザーに通知
3. 次回同期時刻を遅延

#### 関連機能
- FR-001: 銀行口座との連携
- FR-002: クレジットカードとの連携
- FR-003: 証券会社との連携
- FR-004: バックグラウンド接続確認
- FR-006: 利用履歴自動取得

#### テストケース

##### TC-030-001: デフォルト同期間隔の設定
**前提条件**: なし
**手順**:
1. 設定画面を開く
2. 「標準（6時間ごと）」を選択
3. 保存
**期待結果**: 
- 設定が保存される
- すべての金融機関が6時間ごとに同期される

##### TC-030-002: 金融機関ごとの個別設定
**前提条件**: 2つの金融機関が登録済み
**手順**:
1. 三菱UFJ銀行: 高頻度（1時間ごと）
2. 楽天カード: 低頻度（1日1回）
3. 保存
**期待結果**: 
- 各金融機関が異なる間隔で同期される

##### TC-030-003: カスタム間隔の設定
**前提条件**: なし
**手順**:
1. カスタムを選択
2. 「2時間ごと」と入力
3. 保存
**期待結果**: 
- 2時間ごとに同期が実行される

##### TC-030-004: 手動同期の実行
**前提条件**: 金融機関が登録済み
**手順**:
1. 「今すぐ同期」をクリック
**期待結果**: 
- 即座に同期が開始される
- 完了後、最終同期時刻が更新される

##### TC-030-005: Wi-Fiのみ同期設定
**前提条件**: Wi-Fiのみ同期が有効
**手順**:
1. モバイルネットワークに接続
2. 同期時刻に達する
**期待結果**: 
- 同期がスキップされる
- Wi-Fi接続後に同期が実行される

##### TC-030-006: 夜間モード設定
**前提条件**: 夜間モード有効（22:00-6:00）
**手順**:
1. 23:00に同期時刻に達する
**期待結果**: 
- 同期がスキップされる
- 6:00以降に同期が実行される

##### TC-030-007: 自動リトライ
**前提条件**: 自動リトライ有効、最大3回
**手順**:
1. 同期がエラーで失敗
**期待結果**: 
- 自動的に3回リトライされる
- 3回すべて失敗した場合、ユーザーに通知

##### TC-030-008: 同期履歴の表示
**前提条件**: 複数回の同期実行済み
**手順**:
1. 同期履歴画面を開く
**期待結果**: 
- 過去の同期履歴が日付順に表示される
- 成功/失敗ステータスが表示される

##### TC-030-009: API制限超過時の対応
**前提条件**: API制限に達している
**手順**:
1. 同期を実行
**期待結果**: 
- エラーメッセージが表示される
- 次回同期時刻が自動的に遅延される

##### TC-030-010: 次回同期時刻の計算
**前提条件**: 標準（6時間ごと）設定
**手順**:
1. 10:00に同期完了
**期待結果**: 
- 次回同期時刻が16:00と表示される

#### パフォーマンス要件
- 設定保存: 500ms以内
- 手動同期開始: 1秒以内（同期自体は除く）
- 同期履歴の表示: 1秒以内
- バックグラウンド同期: ユーザー体験に影響を与えない

#### UI/UX要件
- 同期中はプログレスバーまたはスピナーを表示
- 次回同期時刻を分かりやすく表示
- 同期完了時は控えめな通知
- エラー時は具体的な対処方法を提示
- 設定変更後は即座に反映

---

## FR-031: カテゴリ・費目のカスタマイズ

### 基本情報
| 項目 | 内容 |
|------|------|
| 機能ID | FR-031 |
| 機能名 | カテゴリ・費目のカスタマイズ |
| 優先度 | 中 |
| 対応Phase | Phase 4 |

### 概要
ユーザーが独自のカテゴリや費目を作成・編集・削除できる機能。個人のライフスタイルに合わせた分類を実現する。

### 詳細仕様

#### カテゴリ体系

##### レベル1: 主要カテゴリ（固定）
- 収入（INCOME）
- 支出（EXPENSE）
- 振替（TRANSFER）
- 返済（REPAYMENT）
- 投資（INVESTMENT）

※主要カテゴリは削除・変更不可

##### レベル2: 大カテゴリ（カスタマイズ可）
デフォルト例（支出の場合）:
- 食費
- 住居費
- 交通費
- 通信費
- 娯楽費
- 医療費
- 教育費
- その他

##### レベル3: 小カテゴリ（カスタマイズ可）
デフォルト例（食費の場合）:
- 食料品
- 外食
- カフェ
- 飲み会
- 弁当・惣菜

#### カスタマイズ画面UI

```
┌─────────────────────────────────────────┐
│ カテゴリ・費目設定                         │
├─────────────────────────────────────────┤
│ [支出 ▼]                                 │
│                                          │
│ ■ 大カテゴリ                              │
│ [+ 大カテゴリを追加]                       │
│                                          │
│ ┌──────────────────────────────────┐    │
│ │ 🍽️ 食費                            │    │
│ │ [編集] [削除] [▼]                  │    │
│ │                                    │    │
│ │ 小カテゴリ:                        │    │
│ │ - 食料品        [編集] [削除]      │    │
│ │ - 外食          [編集] [削除]      │    │
│ │ - カフェ        [編集] [削除]      │    │
│ │ [+ 小カテゴリを追加]               │    │
│ └──────────────────────────────────┘    │
│                                          │
│ ┌──────────────────────────────────┐    │
│ │ 🏠 住居費                          │    │
│ │ [編集] [削除] [▼]                  │    │
│ │                                    │    │
│ │ 小カテゴリ:                        │    │
│ │ - 家賃・住宅ローン [編集] [削除]   │    │
│ │ - 水道光熱費    [編集] [削除]      │    │
│ │ - 住宅修繕費    [編集] [削除]      │    │
│ │ [+ 小カテゴリを追加]               │    │
│ └──────────────────────────────────┘    │
│                                          │
│ ■ 自動分類ルール                          │
│ [+ ルールを追加]                          │
│                                          │
│ - キーワード「スーパー」→ 食費/食料品      │
│   [編集] [削除]                           │
│ - キーワード「飲み会」→ 食費/飲み会       │
│   [編集] [削除]                           │
│                                          │
│ [保存]                                   │
└─────────────────────────────────────────┘
```

#### カテゴリ追加画面

```
┌─────────────────────────────────────────┐
│ 大カテゴリを追加                           │
├─────────────────────────────────────────┤
│ 主要カテゴリ: 支出                        │
│                                          │
│ カテゴリ名: [____________]                │
│                                          │
│ アイコン: [🍕 選択 ▼]                    │
│                                          │
│ 色: [🎨 選択]                            │
│ ○ 青 ○ 緑 ● 赤 ○ 黄 ○ 紫               │
│                                          │
│ 説明（任意）:                             │
│ [____________________________]           │
│                                          │
│ [キャンセル] [追加]                       │
└─────────────────────────────────────────┘
```

#### データ構造

##### カテゴリ定義
```typescript
interface CategoryDefinition {
  id: string;
  name: string;
  type: CategoryType; // 主要カテゴリ
  icon: string;
  color: string;
  description?: string;
  parentId?: string; // 大カテゴリの場合はnull
  order: number;
  isDefault: boolean; // デフォルトカテゴリかどうか
  isActive: boolean;  // 有効/無効
  createdAt: Date;
  updatedAt: Date;
}

// カテゴリ階層
interface CategoryHierarchy {
  mainCategory: CategoryType;
  largeCategories: CategoryDefinition[];
  smallCategories: {
    [largeCategoryId: string]: CategoryDefinition[];
  };
}
```

##### 自動分類ルール
```typescript
interface AutoClassificationRule {
  id: string;
  priority: number;
  conditions: RuleCondition[];
  categoryId: string;    // 大カテゴリID
  subcategoryId?: string; // 小カテゴリID
  isActive: boolean;
  matchCount: number;     // マッチした回数（統計用）
  createdAt: Date;
}

interface RuleCondition {
  field: 'description' | 'amount' | 'institutionType' | 'accountId';
  operator: 'contains' | 'equals' | 'greaterThan' | 'lessThan' | 'regex';
  value: string | number;
}

// ルール例
{
  id: 'rule_001',
  priority: 1,
  conditions: [
    { field: 'description', operator: 'contains', value: 'セブンイレブン' }
  ],
  categoryId: 'cat_food',
  subcategoryId: 'subcat_grocery',
  isActive: true
}
```

#### 入力
**カテゴリ追加時**:
- 主要カテゴリ選択
- カテゴリ名
- アイコン
- 色
- 説明（任意）

**自動分類ルール追加時**:
- 条件（フィールド、演算子、値）
- 振り分け先カテゴリ
- 優先度

#### 出力
- カテゴリ一覧
- 自動分類ルール一覧
- 保存成功/失敗通知

#### 処理フロー

##### カテゴリ追加フロー
```
1. ユーザーが「カテゴリを追加」をクリック
2. 追加フォームを表示
3. ユーザーが情報を入力
4. [バリデーション]
   a. カテゴリ名の重複チェック
   b. 必須項目チェック
   c. 文字数制限チェック
5. [保存]
   a. 一意のIDを生成
   b. データに追加
   c. orderを最後尾に設定
6. [UI更新] カテゴリ一覧を更新
7. [通知] 追加成功を通知
```

##### カテゴリ編集フロー
```
1. ユーザーが「編集」をクリック
2. 現在の情報を表示
3. ユーザーが情報を変更
4. [バリデーション]
5. [保存] データを更新
6. [再集計] このカテゴリに属する取引を再カウント
7. [UI更新] 変更を反映
8. [通知] 更新成功を通知
```

##### カテゴリ削除フロー
```
1. ユーザーが「削除」をクリック
2. [確認ダイアログ]
   a. 使用中の取引件数を表示
   b. 振替先カテゴリを選択
      - 「未分類」に移動
      - 別のカテゴリに移動
3. ユーザーが確認
4. [取引の振替]
   a. 該当する取引を検索
   b. 新しいカテゴリに更新
5. [削除実行] カテゴリを削除
6. [UI更新] 一覧から削除
7. [通知] 削除完了を通知
```

##### 自動分類ルール追加フロー
```
1. ユーザーが「ルールを追加」をクリック
2. ルール設定フォームを表示
3. ユーザーが条件を設定
   a. フィールド選択
   b. 演算子選択
   c. 値入力
4. 振り分け先カテゴリを選択
5. [テスト実行] 既存データに対してルールをテスト
6. [マッチ件数表示] 何件の取引がマッチするか表示
7. ユーザーが保存を確認
8. [保存] ルールを追加
9. [通知] 追加成功、適用は次回同期時から
```

##### 自動分類の適用フロー
```
1. 新しい取引データを取得
2. [ルール適用]
   a. 優先度順にルールを評価
   b. 最初にマッチしたルールを適用
   c. カテゴリを設定
3. [マッチしない場合]
   a. デフォルトルールを試行
   b. それでもマッチしない場合「未分類」
4. [統計更新] ルールのマッチ回数を増加
5. [保存] カテゴリ付き取引を保存
```

##### 並び順変更フロー
```
1. ユーザーがカテゴリをドラッグ&ドロップ
2. [順序更新] 各カテゴリのorder値を更新
3. [保存] 新しい順序を保存
4. [UI更新] 即座に反映
```

#### バリデーション
- カテゴリ名: 1〜50文字
- カテゴリ名の重複チェック（同じ主要カテゴリ内）
- アイコン: 必須
- 色: 必須
- 説明: 0〜200文字
- 自動分類ルールの条件: 最低1つ必要
- ルールの値: 空文字不可

#### デフォルトカテゴリ

##### 収入
- 給与
- 賞与
- 副業・事業収入
- 配当・利息
- 還付金・キャッシュバック
- その他収入

##### 支出
- 食費（食料品、外食、カフェ、飲み会）
- 住居費（家賃、水道光熱費、修繕費）
- 交通費（電車、バス、タクシー、ガソリン、駐車場）
- 通信費（スマホ、インターネット、郵便）
- 日用品（生活雑貨、衣料品、美容）
- 医療費（病院、薬、保険）
- 娯楽費（趣味、旅行、書籍、サブスク）
- 教育費（授業料、教材、習い事）
- 交際費（プレゼント、冠婚葬祭）
- 保険（生命保険、損害保険）
- 税金（所得税、住民税、固定資産税）
- その他支出

##### 振替
- 口座間送金
- クレジットカード引落
- 電子マネーチャージ
- 証券口座入金

##### 返済
- 住宅ローン
- 自動車ローン
- 教育ローン
- カードローン

##### 投資
- 株式購入
- 投資信託購入
- 債券購入
- 配当金受取
- 売却益

#### エラー処理
| エラーコード | エラー内容 | 対処方法 |
|-------------|-----------|---------|
| CT001 | カテゴリ名が重複 | 別の名前を入力してください |
| CT002 | カテゴリ名が未入力 | カテゴリ名を入力してください |
| CT003 | 文字数制限超過 | 50文字以内で入力してください |
| CT004 | 使用中のカテゴリを削除 | 振替先を指定してください |
| CT005 | デフォルトカテゴリを削除 | デフォルトカテゴリは削除できません |
| CT006 | ルールの条件が不正 | 条件を正しく設定してください |
| CT007 | 保存失敗 | システムエラー、再試行してください |

#### デフォルト自動分類ルール例

```typescript
const defaultRules: AutoClassificationRule[] = [
  // 食費
  {
    id: 'rule_food_01',
    priority: 10,
    conditions: [
      { field: 'description', operator: 'contains', value: 'セブンイレブン' }
    ],
    categoryId: 'cat_food',
    subcategoryId: 'subcat_grocery'
  },
  {
    id: 'rule_food_02',
    priority: 10,
    conditions: [
      { field: 'description', operator: 'contains', value: 'スターバックス' }
    ],
    categoryId: 'cat_food',
    subcategoryId: 'subcat_cafe'
  },
  
  // 交通費
  {
    id: 'rule_transport_01',
    priority: 10,
    conditions: [
      { field: 'description', operator: 'contains', value: 'Suica' }
    ],
    categoryId: 'cat_transport',
    subcategoryId: 'subcat_train'
  },
  
  // 通信費
  {
    id: 'rule_communication_01',
    priority: 10,
    conditions: [
      { field: 'description', operator: 'contains', value: 'ドコモ' }
    ],
    categoryId: 'cat_communication',
    subcategoryId: 'subcat_mobile'
  },
  
  // 娯楽費
  {
    id: 'rule_entertainment_01',
    priority: 10,
    conditions: [
      { field: 'description', operator: 'contains', value: 'Netflix' }
    ],
    categoryId: 'cat_entertainment',
    subcategoryId: 'subcat_subscription'
  }
];
```

#### 関連機能
- FR-008: 主要カテゴリ分類
- FR-009: 詳細費目分類
- FR-010: 費目の手動修正
- FR-018: カテゴリ別集計
- FR-019: 費目別集計

#### テストケース

##### TC-031-001: 大カテゴリの追加
**前提条件**: なし
**手順**:
1. 「カテゴリを追加」をクリック
2. 主要カテゴリ「支出」を選択
3. 名前「ペット費用」を入力
4. アイコンと色を選択
5. 保存
**期待結果**: 
- 新しいカテゴリが一覧に追加される
- 選択したアイコンと色で表示される

##### TC-031-002: 小カテゴリの追加
**前提条件**: 大カテゴリ「ペット費用」が存在
**手順**:
1. 「ペット費用」を展開
2. 「小カテゴリを追加」をクリック
3. 名前「ペットフード」を入力
4. 保存
**期待結果**: 
- ペット費用の配下に小カテゴリが追加される

##### TC-031-003: カテゴリの編集
**前提条件**: カテゴリ「ペット費用」が存在
**手順**:
1. 「編集」をクリック
2. 名前を「ペット関連費」に変更
3. 保存
**期待結果**: 
- カテゴリ名が更新される
- 既存の取引も新しい名前で表示される

##### TC-031-004: カテゴリの削除（振替先指定）
**前提条件**: カテゴリ「ペット費用」に10件の取引が紐付いている
**手順**:
1. 「削除」をクリック
2. 確認ダイアログで「その他支出」を振替先に選択
3. 削除を確認
**期待結果**: 
- カテゴリが削除される
- 10件の取引が「その他支出」に移動される

##### TC-031-005: 自動分類ルールの追加
**前提条件**: なし
**手順**:
1. 「ルールを追加」をクリック
2. 条件: description contains "Amazon"
3. 振り分け先: 日用品/生活雑貨
4. テスト実行
5. マッチ件数を確認
6. 保存
**期待結果**: 
- ルールが追加される
- 次回取得時、Amazonの取引が自動分類される

##### TC-031-006: 自動分類ルールの優先度
**前提条件**: 複数のルールが存在
**手順**:
1. ルールA（priority=1）: description contains "セブン"
2. ルールB（priority=10）: description contains "セブンイレブン"
3. 「セブンイレブン」を含む取引を取得
**期待結果**: 
- 優先度が高いルールB（10）が適用される

##### TC-031-007: カテゴリの並び順変更
**前提条件**: 複数のカテゴリが存在
**手順**:
1. 「ペット費用」を「食費」の上にドラッグ
**期待結果**: 
- 並び順が変更される
- 保存後も順序が維持される

##### TC-031-008: デフォルトカテゴリの削除防止
**前提条件**: デフォルトカテゴリ「食費」が存在
**手順**:
1. 「食費」の削除を試みる
**期待結果**: 
- エラーメッセージが表示される
- 削除できない

##### TC-031-009: カテゴリ名の重複チェック
**前提条件**: カテゴリ「食費」が存在
**手順**:
1. 新しいカテゴリを追加
2. 名前を「食費」と入力
3. 保存を試みる
**期待結果**: 
- エラーメッセージが表示される
- 保存できない

##### TC-031-010: 未分類取引の一覧表示
**前提条件**: 自動分類されなかった取引が存在
**手順**:
1. 「未分類」カテゴリを表示
**期待結果**: 
- 自動分類されなかった取引が一覧表示される
- 手動で分類できる

#### パフォーマンス要件
- カテゴリ一覧の表示: 500ms以内
- カテゴリの追加・編集・削除: 1秒以内
- 自動分類ルールの適用: 取引1件あたり10ms以内
- ドラッグ&ドロップのレスポンス: 即座

#### UI/UX要件
- ドラッグ&ドロップで並び順変更
- 色分けで視覚的に識別しやすく
- アイコンで直感的に理解できる
- 使用頻度の高いカテゴリを上部に表示
- 未分類の取引件数をバッジ表示
- カテゴリごとの使用回数・金額を表示
- カテゴリのインポート/エクスポート機能（将来）

---

## まとめ

本機能要件書では、設定機能に関する4つの機能要件（FR-028〜FR-031）を定義しました。

### 主要機能
1. **FR-028**: 金融機関接続設定の画面管理 - ユーザーが画面上で金融機関との連携を管理
2. **FR-029**: 認証情報の登録・更新・削除 - 暗号化による安全な認証情報管理
3. **FR-030**: データ同期間隔の設定 - ユーザーのニーズに応じた同期頻度のカスタマイズ
4. **FR-031**: カテゴリ・費目のカスタマイズ - 個人のライフスタイルに合わせた分類体系

### 重要なポイント
- **セキュリティ**: 認証情報の暗号化、監査ログ、アクセス制御
- **柔軟性**: ユーザーごとのカスタマイズ可能な設定
- **使いやすさ**: 直感的なUI、明確なエラーメッセージ
- **拡張性**: 将来的な機能追加を考慮した設計

これらの設定機能により、ユーザーは自分の資産管理スタイルに合わせてアプリケーションをカスタマイズできます。

